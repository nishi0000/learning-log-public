
## 1. この時やりたかったこと

- すでに **GET /todos** は動いていて、Vueでもリスト表示できた
    
- 次は **POST /todos** を追加して、
    
    - API Gateway → Lambda に POST が届く
        
    - Lambda 側で「POSTなら別レスポンス」を返す
        
    - まずはDBなしで「POSTが通った実感」を作る  
        ところまで確認したかった
        

---

## 2. この時点でできていたこと（前提）

- Lambda（C#）は **配列JSON** を返せている（GETで動作確認済み）
    
- API Gateway で `/todos` の **GET/POSTルート自体は作成済み**
    
- Vueは `v-for` で **2件のタイトル表示**ができている
    
- PowerShell で API を叩ける状態だった
    

---

## 3. Lambda側で「POST分岐」を入れようとして起きたこと

### やろうとしたこと

- リクエストのHTTPメソッドを見て
    
    - POSTなら固定レスポンス（`posted todo`）を返す
        
    - それ以外（GET）は今まで通り配列を返す
        
- 目的はDB保存ではなく **「POSTが来た」ことの確認**
    

### 実際に入れた分岐（意図）

- `method == "POST"` なら `id=999 / posted todo` を返す
    
- それ以外は既存の `id=1,2` 配列を返す
    

---

## 4. つまずき①：POSTで叩いたのにGETの配列が返ってきた（再現）

### 実際にやったこと

- PowerShellで `Invoke-RestMethod -Method Post` を実行して `/todos` にPOSTした
    

### 実際に返ってきたレスポンス

- `id=1 sample todo`
    
- `id=2 second todo`
    

つまり、**POSTしたのに、GETの配列レスポンス**が返った

### この時点での混乱ポイント

- 「POSTで叩いてるのに、なんでGET側の返り値？」
    
- 「Lambdaの分岐が効いてない？ それともAPI Gateway側がおかしい？」
    

---

## 5. 切り分け方針を決めた（ここで認識が揃った）

### 立てた仮説（2択）

- (A) Lambda側で method 判定が取れてなくて、`if (method == "POST")` に入れてない
    
- (B) API Gateway側で、POSTが別の統合先（古いLambda/別Lambda）を見ている
    

### この時のポイント

- 体感として「POSTがGETになってる」よりも、  
    **“分岐が効いてない／反映されてない” 可能性**が高い、と整理した
    

---

## 6. つまずき②：CloudWatchを見たけど「自分のログが出てない」ように見えた

### 実際に見たもの

- CloudWatch Logs に **INIT/START/END/REPORT** だけが出ていた
    
- 自分が追加したはずの `context.Logger.LogLine(...)` が見当たらなかった
    

### この時の誤解の種

- 「ログが出てない＝コードが反映されてない？」と思いかけた
    
- でも、ログ画面は **見ているstream/表示が最新を追えていない**ことがある
    

---

## 7. 解決：画面を更新してからPOSTを叩いたら、POST分岐が返った

### 実際にやったこと

- CloudWatch（ログ画面）を **更新**
    
- 改めて PowerShell で POST を叩き直した
    

### 実際に返ってきたレスポンス（決定打）

- `id=999 posted todo`
    

つまり、**POSTがPOSTとして処理され、POST分岐に入った**ことが確定した

---

## 8. このスレッドで得た認識（重要）

- PowerShellでのPOST実行自体はできている（`POST with 1-byte payload` が出ていた）
    
- CloudWatch Logs は
    
    - 自動で追従しているとは限らない
        
    - 見ているログが最新とは限らない
        
- 「今のコードが動いてるか」は
    
    - ログだけじゃなく、**レスポンスに目印（id=999）を入れる**と一発で確定できる
        

---

## 9. 次回やること（この流れを壊さないための“次の確認点”）

- GET/POSTの両方を叩いて、期待通りに分岐していることをもう一度確認する
    
    - GET → `id=1,2`
        
    - POST → `id=999 posted todo`
        
- CloudWatchは「更新」か「テーリング」で、**叩いた直後のログを追える状態**にしてから見る
    

---

## 10. 区切り

- POSTを叩いて **id=999 posted todo** が返るところまで確認できた
    
- 「POSTなのにGETが返る」現象は、最終的に **状況の見え方（ログ画面更新/追従）**のズレが絡んでいた