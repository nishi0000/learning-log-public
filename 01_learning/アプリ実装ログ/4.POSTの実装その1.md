
# 実装ログ（Vue → API Gateway → Lambda / C# 一気通貫 続き）

## 1. この時やりたかったこと

- すでに **GET /todos** は動いていて、Vueでもリスト表示できた
    
- 次は **POST /todos** を追加して、
    
    - API Gateway → Lambda に POST が届く
        
    - Lambda 側で「POSTなら別レスポンス」を返す
        
    - まずはDBなしで「POSTが通った実感」を作る  
        ところまで確認したかった
        

---

## 2. この時点でできていたこと（前提）

- Lambda（C#）は **配列JSON** を返せている（GETで動作確認済み）
    
- API Gateway で `/todos` の **GET/POSTルート自体は作成済み**（画面にPOST/GETが並んでいた）
    
- Vueは `v-for` で **2件のタイトル表示**ができている
    

---

## 3. Lambda側で「POST分岐」を入れようとして起きたこと

### やろうとしたこと

- `request` の中の HTTPメソッドを見て
    
    - POSTなら固定レスポンス（`posted todo`）を返す
        
    - それ以外（GET）は今まで通り配列を返す
        
- 目的はDB保存ではなく **「POSTが来た」ことの確認**
    

### 追加した分岐（意図）

- `if (method == "POST")` に入ったら、固定JSONを返す
    

---

## 4. つまずき①：メソッドの取り方でコンパイルエラー

### 実際に起きたこと

- `request.RequestContext.Http.Method` を書いたら VSCode がエラーを出した
    

### 実際の原因（認識ズレ）

- いまの関数の引数型は **`APIGatewayProxyRequest`**
    
- その型には **`RequestContext.Http` が存在しない**
    
    - 「データが来たら入るかも」じゃなくて、**型の定義に無いからコンパイルできない**
        

### 修正

- `request.HttpMethod` を見るように変更した
    

```csharp
var method = request.HttpMethod;

if (method == "POST")
{
    var created = new { id = 999, title = "posted todo", completed = false };
    ...
}
```


---

## 5. つまずき②：API Gateway で POST のテストが見当たらない

### 実際に起きたこと

- ルート画面（POST /todos を選んだ画面）に **「テスト」ボタンが無かった**
    

### その時の認識

- 「AWSコンソールからPOSTを叩いて確認できるはず」と思って探した
    

### 実際に起きた理解

- 自分が使っているのは **API Gateway の “HTTP API”**
    
- REST APIの画面で見た「テスト」導線とは違う
    

### その場で取った手段

- ローカル（PowerShell）から叩いて確認する方向に切り替えた
    

---

## 6. PowerShellでPOSTしたのに、返ってきたのはGETの結果だった

### 実際にやったこと

- PowerShellで `Invoke-RestMethod -Method Post` を実行して `/todos` にPOSTした
    

### 実際に返ってきたレスポンス

- `id=1 sample todo`
    
- `id=2 second todo`
    

つまり、**GET側の配列レスポンス**が返ってきた

### この時点での混乱ポイント

- 「POSTで叩いたのに、なんでGETの返り値？」
    
- 「そもそもPOSTできてない？ GETになってる？」
    

### その時点で立った仮説（未解決のまま区切り）

- Lambda側で `request.HttpMethod` が想定通り取れておらず、
    
    - `if (method == "POST")` に入れていない可能性
        
- もしくは API Gateway 側で
    
    - `POST /todos` が別の統合先を見ている（GETと同じ or 古いLambdaを参照している）可能性
        

※この時点では「原因確定」まではいっていない。  
「POSTなのにGETが返る」という現象が起きたところまで。

---

## 7. このスレッドで得た認識（重要）

- **HTTP API / REST API** というAWSの種類があり、画面や導線が違う（テストの場所が違う）
    
- `APIGatewayProxyRequest` は「箱」なので、
    
    - その箱に無いプロパティ（`RequestContext.Http`）は **実行以前にコンパイルで落ちる**
        
- 「POSTを通したい」段階ではDBはまだ不要で、
    
    - **固定レスポンスで分岐できるか**を先に確認するのが有効
        
- ただし今回は、
    
    - POSTで叩いたのにGETの結果が返る、というズレが最後に残った
        

---

## 8. 次回やること（ここまでの流れを壊さないための“次の確認点”）

※手順書ではなく「次回、何を確かめればこのズレが解けるか」のメモ

- **POSTが本当にPOSTとしてLambdaに届いているか**（メソッド判定が効いているか）
    
- **API GatewayのPOSTルートの統合先**が、いまデプロイしたLambdaになっているか
    

（この2点を確認すれば、「POSTなのにGETのレスポンス」が起きた理由が確定できるはず）

---

## 9. 区切り

- Vueでのリスト表示まではOK
    
- LambdaのPOST分岐コードも書けた（コンパイルの概念が腹落ち）
    
- ただし **POSTで叩いてもGETのレスポンスが返る**現象が残ったため、ここで区切り